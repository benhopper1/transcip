console.log('==================================================================');
console.log('--  FILE MUTATOR OBJECT  -----------------------------------------');
console.log('==================================================================');
var path = require('path');
var basePath = path.dirname(require.main.filename);
var fs = require('fs');
var extend = require(basePath + '/node_modules/node.extend');

var gm = require(basePath + '/node_modules/gm');

//========================================================
//----  FILE MUTATOR OBJECT  -----------------------------
//========================================================
var FileMutator = function(inOptions){
	var _this = this;
	var options = 
		{
			name:false,
		}
	options = extend(true, options, inOptions);

	var functionalHash = 
		{//inStream, inType, inFileStruct, inWriteStream, inTargetFileInfo

			//==================================================================
			//--  saveNormalUserImage  -----------------------------------------
			//==================================================================
			saveNormalUserImage:function(inSaveOptions){
				var saveOptions = 
					{
						stream:false,
						type:false,
						fileStruct:false,
						writeStreamFunction:false,
						targetFileInfo:false,
						writeOver:'',
					}
				saveOptions = extend(saveOptions, inSaveOptions);

				if(	saveOptions.stream &&
					saveOptions.fileStruct && 
					saveOptions.fileStruct.fileName &&
					saveOptions.writeStreamFunction 
				){

					gm(saveOptions.stream, saveOptions.fileStruct.fileName)
						.resize('150^', '100^')
						.gravity('Center')
						.quality(100)
						.stroke('#ffffff')
						.font('Helvetica.ttf')
						.drawText(5, 20, saveOptions.writeOver)
						.crop(300, 200)

						.stream(function (err, stdout, stderr) {
							saveOptions.writeStreamFunction(stdout);
						});
					;
					var result = 
						{
							error:false,
							caption:'SUCCESS',
						}
					return result;
				}else{
					//error----------------------------
					var result = 
						{
							error:true,
							where:'saveNormalUserImage',
							caption:'missing input data!!!'
						}
					return result
				}
			},// end saveNormalUserImage ........................................
			//==================================================================
			//--  saveNormalContactImage  -----------------------------------------
			//==================================================================
			saveNormalContactImage:function(inSaveOptions){
				var saveOptions = 
					{
						stream:false,
						type:false,
						fileStruct:false,
						writeStreamFunction:false,
						targetFileInfo:false,
						writeOver:'',
					}
				saveOptions = extend(saveOptions, inSaveOptions);

				if(	saveOptions.stream &&
					saveOptions.fileStruct && 
					saveOptions.fileStruct.fileName &&
					saveOptions.writeStreamFunction 
				){

					gm(saveOptions.stream, saveOptions.fileStruct.fileName)
						.resize('150^', '100^')
						.gravity('Center')
						.quality(100)
						//.stroke('#000000')
						//.font('Arial.ttf', 6)
						//.fill('#000000')
						//.font('Helvetica.ttf', 6)
						.font(basePath + '/library/fonts/DroidSans-Bold.ttf', 10)
						//.drawText(5, 20, saveOptions.writeOver)
						.crop(300, 200)
						.drawText(5, 20, saveOptions.writeOver)

						.stream(function (err, stdout, stderr) {
							saveOptions.writeStreamFunction(stdout);
						});
					;
					var result = 
						{
							error:false,
							caption:'SUCCESS',
						}
					return result;
				}else{
					//error----------------------------
					var result = 
						{
							error:true,
							where:'saveNormalContactImage',
							caption:'missing input data!!!'
						}
					return result
				}
			},// end saveNormalContactImage ........................................
			//==================================================================
			//--  saveNormalContactImage  -----------------------------------------
			//==================================================================
			phoneCacheImage:function(inSaveOptions){
				var saveOptions = 
					{
						stream:false,
						type:false,
						fileStruct:false,
						writeStreamFunction:false,
						targetFileInfo:false,
						writeOver:'',
					}
				saveOptions = extend(saveOptions, inSaveOptions);

				if(	saveOptions.stream &&
					saveOptions.fileStruct && 
					saveOptions.fileStruct.fileName &&
					saveOptions.writeStreamFunction 
				){

					gm(saveOptions.stream, saveOptions.fileStruct.fileName)
						//.resize('150^', '100^')
						//.gravity('Center')
						//.quality(100)
						//.stroke('#000000')
						//.font('Arial.ttf', 6)
						//.fill('#000000')
						//.font('Helvetica.ttf', 6)
						//.font(basePath + '/library/fonts/DroidSans-Bold.ttf', 10)
						//.drawText(5, 20, saveOptions.writeOver)
						//.crop(300, 200)
						//.drawText(5, 20, saveOptions.writeOver)

						.stream(function (err, stdout, stderr) {
							saveOptions.writeStreamFunction(stdout);
						});
					;
					var result = 
						{
							error:false,
							caption:'SUCCESS',
						}
					return result;
				}else{
					//error----------------------------
					var result = 
						{
							error:true,
							where:'phoneCacheImage',
							caption:'missing input data!!!'
						}
					return result
				}
			},// end phoneCacheImage ........................................
		}

		this.mutate = function(inFunctionalKey, inJstruct){
			var theFunction = functionalHash[inFunctionalKey];
			if(theFunction){
				return theFunction(inJstruct);
			}


			// no match in functional hash-------
			var result = 
				{
					error:true,
					where:'mutate()',
					caption:'(' + inFunctionalKey + ') no match in functional hash !!!'
				}
			return result
		}


}
module.exports = FileMutator;